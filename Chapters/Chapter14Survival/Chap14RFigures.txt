#  FILENAME IS Chap14RFigures.txt ;


#setwd("R://Book3//CUPBook//Chapter14Survival")
setwd("c://Book3//CUPBook//Chapter14Survival")
library(HH)

#  FIGURE 14.1A
plot.new()
par(mar=c(0,0,0,0), cex=1.5)
plot.window(xlim=c(0,14),ylim=c(0,2))

arrows(1,1,13.5,1,code=2,lwd=2,angle=25,length=0.10)

#text(4,2,expression(y[L]^{"*"}),adj=0, cex=0.8)
#text(8,2,expression(y[U]^{"*"}),adj=0, cex=0.8)

text(0.8,1.5,"No exact value under",adj=0, cex=0.8)
text(1.9,1.2,"left-censoring",adj=0, cex=0.8)

text(8.2,1.5,"No exact value under",adj=0, cex=0.8)
text(8.2,1.2,"right-censoring",adj=0, cex=0.8)

text(1,1,labels="|",adj=0)
text(4.5,1,labels="|",adj=0)
text(8,1,labels="|",adj=0, cex=1)


text(1,  0.6,expression(0),adj=0)
text(4.5,0.6,expression(C[L]),adj=0)
text(8,  0.6,expression(C[U]),adj=0)
text(6,  0.3,expression(y),adj=0, cex=1.1)

export.eps("F14CensoringA.eps", width=8,height=2) 
dev.off()

#  FIGURE 14.2  MORTALITY STUDY
plot.new()
par(mar=c(0,0,0,0), cex=1.5)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(1.2,1.2,13.5,1.2,code=2,lwd=2,angle=25,length=0.10)
text(6,0.5,"Calendar Time",adj=0)
arrows(1.5,8,11,8,code=2,lwd=2,angle=25,length=0.10)
text(11.5,8,"A",adj=0, cex=0.8)
arrows(1.8,7,6,7,code=2,lwd=2,angle=25,length=0.10)
text(7,7,"B",adj=0, cex=0.8)
arrows(4,6,11.2,6,code=2,lwd=2,angle=25,length=0.10)
text(11.5,6,"C",adj=0, cex=0.8)
arrows(3.5,5,6.5,5,code=2,lwd=2,angle=25,length=0.10)
text(7,5,"D",adj=0, cex=0.8)
arrows(1,4,2.8,4,code=2,lwd=2,angle=25,length=0.10)
text(3.5,4,"E",adj=0, cex=0.8)
arrows(9,3,11.4,3,code=2,lwd=2,angle=25,length=0.10)
text(11.5,3,"F",adj=0, cex=0.8)

arrows(2.9,9,3,1,code=2,lwd=2,angle=0,length=0.10)
text(2.5,9.3,"1/1/2010",adj=0, cex=0.7)
arrows(5.4,9,5.5,1,code=2,lwd=2,angle=0,length=0.10)
text(4.9,9.3,"1/1/2011",adj=0, cex=0.7)
arrows(7.9,9,8,1,code=2,lwd=2,angle=0,length=0.10)
text(7.4,9.3,"1/1/2012",adj=0, cex=0.7)

export.eps("F14Mortality.eps", width=6,height=6) 
dev.off()

library(survival)
fix(aml)
setwd("c://Book3//CUPBook//Chapter14Survival")
aml = read.csv(choose.files(), header=TRUE)

fit <- survfit(Surv(time, status) ~ x , data=aml)
plot(fit)
text(50,0.7,"Maintained",adj=0, cex=1.2)
text(1,0.05,"Control",adj=0, cex=1.2)
export.eps("F14ProductLimitA.eps", width=4,height=4) 
dev.off()

aml2 = subset(aml, x=="Nonmaintained" )
fit <- survfit(Surv(time, status) , data=aml2)
plot(fit)
export.eps("F14ProductLimitB.eps", width=4,height=4) 
dev.off()


#  FIGURE 14.XX  WARRANTY CLAIMS
plot.new()
par(mar=c(0,0,0,0), cex=1.5)
plot.window(xlim=c(0,14),ylim=c(0,10))
arrows(1.2,1.2,13.5,1.2,code=2,lwd=2,angle=25,length=0.10)
text(6,0.5,"Calendar Time",adj=0)

arrows(1.5,8,13,8,code=2,lwd=2,angle=25,length=0.10)
text(5,8,labels="|",adj=0)
text(4.7,7.5,expression(y["2,1"]),adj=0, cex=0.8)

arrows(1.5,6,13,6,code=2,lwd=2,angle=25,length=0.10)
text(3.5,6,labels="|",adj=0)
text(3.2,5.5,expression(y["13,1"]),adj=0, cex=0.8)
text(6,6,labels="|",adj=0)
text(5.7,5.5,expression(y["13,2"]),adj=0, cex=0.8)
text(9,6,labels="|",adj=0)
text(8.7,5.5,expression(y["13,3"]),adj=0, cex=0.8)

arrows(1.5,4,13,4,code=2,lwd=2,angle=25,length=0.10)
text(8,4,labels="|",adj=0)
text(7.7,3.5,expression(y["24,1"]),adj=0, cex=0.8)


arrows(3,9,3,1,code=2,lwd=2,angle=0,length=0.10)
text(2.5,9.3,"0 days",adj=0, cex=0.7)
arrows(11,9,11,1,code=2,lwd=2,angle=0,length=0.10)
text(10.4,9.3,"365 days",adj=0, cex=0.7)

export.eps("F14Warranty.eps", width=5,height=5) 
dev.off()


