
```{r include=FALSE}
Ch1PdfEval  <- knitr:::is_latex_output()
Ch1Eval <- TRUE
```

\index{portfolio theory|see{asset portfolio theory}}
\index{Markowitz portfolio theory|see{asset portfolio theory}}
\index{constrained optimization!binding constraints|see{active constraints}}
\index{copula!normal|see{Gaussian}}
\index{sensitivity analysis|seealso{risk measure!sensitivity}}


\setcounter{chapter}{0}
# Introduction  {#C1Introduction}

*Chapter Preview*. Organizations face many risks, some of which are readily quantifiable whereas others are not. To set the stage for the rest of the book, Section \@ref(Sec:MultipleRisks) describes some of the many risks that concern organizations. These risks can be transferred to other entities, such as insurers, for a price and this section emphasizes the importance of the economic activity of the insurance sector.

Instead of only abstract theories, Section \@ref(Sec:IllustCases) introduces two case studies that not only motivate the problem of transferring risks but also provide real examples where quantitative tools for managing multiple risks would be of value. These case studies will be referred to throughout the book as bases for pilot studies when new risk management tools are introduced.

\index{asset portfolio theory}


Methods for managing portfolios of risks faced by firms are similar to, yet differ from, methods that have been developed for investment portfolios. Drawing parallels from the world of finance, Section \@ref(Sec:InvestStrategy) introduces asset portfolio management strategies. Motivated by the pioneering work of @markowitz1952utility, managers of financial assets examine trade-offs between the expected gains of a portfolio of assets relative to its uncertainty, typically calibrated using the variance or standard deviation of returns. In the same way, the collection of an organization's non-asset risks can also be thought of as a portfolio and, as argued in this book, can be managed using methods analogous to asset portfolio techniques. 

To appreciate the nature of the tools being developed here, Section \@ref(Sec:MinScenario) analyzes some "minimal scenarios," situations where we strip away almost all features that could make a tool practicable. Minimally complex by design, these scenarios are sufficient to demonstrate the resolution of a problem without any additional complexity that could make the resolution harder. Through these scenarios, we are able to demonstrate the importance of dependence among risks, introduce budget constraints as a cost of transferring risks, and provide advice on alternative forms of risk transfer.

Section \@ref(Sec:Overview) closes the chapter with an overview of the rest of the book.


## Firms Face Multiple Risks {#Sec:MultipleRisks}

Organizations face a multitude of risks. The specific risks vary by industry, size of the firm, location of the business and many other factors. The risks can vary from broad concerns such as "economic slowdown" that affects virtually every organization to risks such as "regulatory changes" that are of concern to firms in a specific industry and regulatory jurisdiction. Some risks are readily quantifiable such as "property damage" whereas others such as "reputation damage" are less so.

One way to get insights into the breadth of risk that a firm faces is to look to concerns expressed by risk managers. To this end, I cite a survey of global risk managers conducted by Aon in 2019, @Aon2019global (for another viewpoint, see a Deloitte survey, @Deloitte2019global). From the survey (Page 13) "Each year we offer respondents the chance to assess their future risk landscape and project the top 5 risks that their organizations will face in three years' time." The survey identifies 69 risks, some which are insurable, some partially insurable, and some uninsurable. For example, the top five risks are: 

1. Economic slowdown/ slow recovery - uninsurable
2. Damage to reputation/brand - partially insurable
3. Accelerated rates of change in market factors - uninsurable
4. Business interruption - insurable
5. Increasing competition - uninsurable

This survey was conducted in mid-2019  before the onslaught of the COVID pandemic. Interestingly, global risk managers only identified "Pandemic risk/ health crises" as rank number 60 risk factor. Unlike pandemic risks, we will analyze risks that a manager might transfer to another organization and so focus insurable risks. From the survey, the top insurable risks (with their rank in the survey) are given in [Table 1.1].

\newpage

<a id=tab:1.1></a> 

[Table 1.1]: \#tab:1.1

Table 1.1. **Top Insurable Risks Facing Firms** (*Source*: @Aon2019global)

$$
\small{
\begin{matrix}
\begin{array}{l|l} \hline \hline
    \textbf{Risk} &  \textbf{Risk} \\ \hline
\text{4.   Business interruption}  & \text{44. Directors and Officers personal liability}\\
\text{19. Counter-party credit risk} & \text{47. Fraud}\\
\text{21. Property damage} & \text{52. Theft}\\
\text{22. Environmental risk} & \text{55. Terrorism sabotage}\\
\text{23. Weather  natural disasters} & \text{56. Safety and Pharmacovigilance}\\
\text{24. Third party liability}  & \text{61. Harassment  discrimination}\\
\text{28. Injury to workers} & \text{66. Kidnap and ransom}\\
\text{40. Product recall}  & \text{67. Extortion}\\
\hline \hline
\end{array} 
\end{matrix}
}
$$

\index{commercial insurance}
Although the techniques developed in this book can be applied to personal insurance and reinsurance, our focus is on transferring risks of companies. Even though insurance is only one mechanism for doing so, commercial insurance by itself plays an important role in the global economy. According to the [Insurance Information Institute](
https://www.iii.org/fact-statistic/facts-statistics-commercial-lines), commercial lines account for 48.0% of non-life insurance premiums. From the @OECD22, non-life premiums account for about 51.7\% of insurance premiums (with life insurance taking up the balance). And finally, also from the [OECD](https://data.oecd.org/insurance/insurance-spending.htm), insurance premiums are approximately 9.5\% of world GDP (gross domestic product). Taken together, one can argue that commercial premiums are approximately 2.3\% of world GDP, a significant portion of the world economy.

To summarize general (non-life) insurance, Table \@ref(tab:Table12) employs the classification used by the *Organization for Economic Co-operation and Development (OECD)*. The publication @OECD2020global provides many statistics, including premiums written by class of insurance business. Table \@ref(tab:Table12) gives a sense of relative activity by summarizing gross premiums paid in each class of insurance; from @OECD2020global, "Gross premiums are total premiums written, excluding any premium taxes or other charges, but before deduction of commission or reinsurance outwards. It is acknowledged that the inclusion of reinsurance will mean that there is some element of double-counting in the figures provided."


`r HideRCode('Motivation.1Silly',"")`

```{r  eval = HtmlEval, echo = FALSE}
s=2
knitr::kable(s, caption = "Silly. Create a table just to update the counter...")
```

</div>

\setcounter{table}{1}

```{r Table12, echo = FALSE}
col1 <- c("Motor Vehicle Insurance", 
"Marine Aviation", "and Other", "Transport Insurance", "","",
"Freight Insurance",
"Fire and other Property", "Damage Insurance",
"Pecuniary Loss", "Insurance", "",
"General Liability Insurance", "Accident and Health Insurance", "",
"Other Non-Life Insurance", "Treaty Reinsurance","\\textbf{Total}")
col2 <- c("589,572", "32,783","","","","",
          "35,132","377,572","",
          "64,620","","",
          "234,993","1,073,109","",
          "102,875","5,665","2,516,320")

Line1 <- "\\textit{Land Vehicles} (other than railway rolling stock) covering all damage to or loss of: land motor vehicles, and land vehicles other than motor vehicles"
Line2 <- "\\textit{Railway rolling stock and other transport} covering all damage to or loss of railway rolling stock"
Line3 <- "\\textit{Aircraft} covering all damage to or loss of aircraft"
Line4 <- "\\textit{Ships} (sea, lake, and river and canal vessels) covering all damage to or loss of: river and canal vessels, lake vessels, and sea vessels"
Line5 <- "\\textit{Aircraft Liability} covering all liability arising out of the use of aircraft (including carrier's liability)"
Line6 <- "\\textit{Liability for Ships} (sea, lake, and river and canal vessels) covering all liability arising out of  the use of ships, vessels or boats on the sea, lakes, rivers or canals (including carrier's liability)"
Line7 <- "\\textit{Goods In Transit} including merchandise, baggage and all other goods) consisting of  all damage to or loss of goods in transit or baggage, irrespective of the form of transport"
Line8 <- "\\textit{Fire and Natural Forces} covering all damage or loss of property (other than land vehicles,  railway rolling stock, aircraft, ships and goods in transit) due to: fire, explosion, storm, natural forces other than storm, nuclear energy, and land subsidence"
Line9 <- "\\textit{Other Damage to Property} covering all damage to or loss of property (other than land vehicles, railway rolling stock, aircraft, ships and goods in transit) due to hail or frost, and  any event such as theft, other than those mentioned under Fire and Natural Forces"
Line10 <- "\\textit{Credit} including insolvency (general), export credit, installment credit, mortgages, and agricultural credit"
Line11 <- "\\textit{Suretyship}"
Line12 <- "\\textit{Miscellaneous Financial Loss} including employment risk, insufficiency of income (general), bad weather,loss of benefits, continuing general expenses, unforseen trading expenses, loss of market value, loss of rent or revenue, indirect trading losses other than those mentioned above, other financial loss (non trading), and other forms of financial loss"
Line13 <- "\\textit{General Liability} covering all liability other than motor vehicle liability, aircraft liability and liability for ships"
Line14 <- "\\textit{Accident} including industrial injury and occupational diseases,  consisting of fixed pecuniary benefits, benefits in the nature of indemnity, combinations of the two, and injury to passengers"
Line15 <- "\\textit{Sickness} consisting of fixed pecuniary benefits and benefits in the nature of indemnity"
Line16 <- "\\textit{Legal Expenses and Costs of Litigation, Assistance, Miscellaneous}"
Line17 <- "\\textit{Treaty Reinsurance}"
Line18 <- ""
footnote1 <- "Note: 2018 Premiums are in milllions of U.S. Dollars."
footnote2 <- "Source: OECD, https://stats.oecd.org/Index.aspx?DatasetCode=INSIND"

Descrip <- c(Line1,Line2,Line3,Line4,Line5,Line6,Line7,Line8,Line9,Line10,Line11,Line12,Line13,Line14,Line15,Line16,Line17,Line18)

if (HtmlEval){
   Descrip <- gsub(pattern="\\\\t", replacement="\\$\\\\ \\{ \\\\small \\\\t", Descrip)
   Descrip <- gsub(pattern="\\}", replacement="\\}\\}\\$", Descrip)
    col1 <- gsub(pattern="\\\\t", replacement="\\$\\\\ \\{ \\\\small \\\\t", col1)
    col1 <- gsub(pattern="\\}", replacement="\\}\\}\\$", col1)
}

text_tblA <- data.frame(col1, col2,Descrip)
colnames(text_tblA) <- c("Classification", "Premiums",
                         "Classification Components")
if (HtmlEval){
Table<- knitr::kable(text_tblA, caption = "**World Premiums by Classes of Non-Life Insurance**", 
                     booktabs = T, escape = FALSE, align = 'lrl') %>%
  kableExtra::kable_classic(full_width = FALSE) %>% 
  column_spec(1,  width = "2.5cm", bold = TRUE) %>%
  row_spec(0,  bold = TRUE, italic = FALSE) %>%      
  row_spec(c(1,6,7,8,9,12,13,15,16,17), hline_after =T) %>%       
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"))
  add_footnote(Table, c(footnote1, footnote2), notation = "alphabet")  
}

if (PdfEval){
  TextTitle <- "World Premiums by Classes of Non-Life Insurance"
  TextTitle1 <- paste0('\\textbf{',TextTitle,'}', collapse='')
Table<- knitr::kable(text_tblA, caption = TextTitle1, 
                     booktabs = T, escape = FALSE, align = 'lrl') %>%
  kableExtra::kable_classic(full_width = FALSE) %>% 
  kableExtra::column_spec(1,  width = "2.0cm") %>%
  kableExtra::column_spec(2,  width = "1.5cm") %>%    
  kableExtra::column_spec(3, width = "8.0cm") %>% 
  kableExtra::row_spec(0,  bold = TRUE, italic = FALSE) %>%      
  kableExtra::row_spec(c(1,6,7,8,9,12,13,15,16,17), hline_after =T) %>%      
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"),font = 8)
  kableExtra::add_footnote(Table, c(footnote1, footnote2), notation = "alphabet")
}

```


<br>

\index{reinsurance}
In this book, a risk is said to be *insurable* if it potentially can be transferred to another party for a fee. Insurance is the most important mechanism for doing so but others such as self insurance pools, peer to peer risk exchanges, and so forth are also available. Descriptions of these alternatives is a topic taken up in Chapter `r ChapCrossRef(Ch6Eval,"\\@ref(C6ManagePort)", "6")`.

:::: {.blackboxvideo }
```{r, include=HtmlEval, echo=FALSE}
cat('**Video: Section Summary**')
```
:::: 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_9a5tlfd5&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&wid=1_bzqtg0dg" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *"  frameborder="0" title="FreesRiskRetentionChap1_1"></iframe>

</center>


## Illustrative Case Studies {#Sec:IllustCases}

To motivate the conceptual development, the text features two illustrative case studies. The Australian National University (ANU) case describes a situation comparable to that commonly encountered by risk managers at medium and large corporations. The Wisconsin Property Fund case describes an insurance risk pool that has many of the features of a typical multi-line general insurance company.

### Australian National University Case {#Sec:ANUCaseIntro}
\index{case studies!ANU}

Motivated by the importance of insurance to the global economy, we are interested in risk transfers of companies. To be concrete, the "company" that we consider in detail is the [Australian National University (ANU)](https://www.anu.edu.au/about). This university is a large, complex organization that faces many risks. To illustrate its size, from its annual report @ANUAnnReport2020, in 2020 it enjoyed an asset base of about 4.6 billion AUD (which is approximately 3.4 billion USD). To illustrate its complexity, its financial statements summarize many risks including property damage, general liability, cyber security, and so forth. There are 15 risks in total that are further described in Section `r ChapCrossRef(Ch6Eval,"\\@ref(Sec:ANURevision)", "6.3")`; these are the "usual suspects," property and liability risks that are typically encountered by many firms. In our quantitative work, we represent losses from these risks as $(X_1, \ldots, X_{15})$. In the absence of risk transfer agreements, ANU has responsibility for the aggregate sum of risks,

$$
S = X_1 + \cdots + X_{15} .
$$

Although the university is responsible for the aggregate sum of losses, it follows common practice and tracks each risk type separately. Different risk types exhibit different distributions; combining them without tracking risk type can result in poor management decisions.

As a subject of a case study, ANU is ideal in part because we have access to detailed information about its risk management processes. In addition, in 2020 it suffered a major property loss (250 million AUD) meaning that its risk appetite has been subject to renewed scrutiny, see @abcnet11882472. That is, for this year the realized value of $X_1$ was 250 million, suggesting that we will need to employ models that allow for heavy-tail distributions that permit very high values of outcomes with not insignificant probabilities.

  
### Wisconsin Property Fund {#Sec:WiscPropFund}
\index{case studies!Wisconsin property fund}

I also demonstrate the conceptual development of insurable risk portfolios using data from the Wisconsin Local Government Property Insurance Fund. The fund was established to provide property insurance for local government entities that include counties, cities, towns, villages, school districts, fire departments, and other miscellaneous entities. Properties covered under this fund include government buildings, vehicles, and equipment. For example, a county may need coverage for its snow plowing trucks, in addition to its buildings and their contents; @FreesLee2015 and @frees2016multivariate. More details about the project may be found at the [Wisconsin Property Fund Site](https://sites.google.com/a/wisc.edu/local-government-property-insurance-fund).

**Risk Types.** The data consist of six coverage groups; building and contents (BC), contractor's equipment (IM), and four types of motor vehicle coverages. For the motor vehicle types, there are collision and comprehensive coverages, as well as new and old vehicles. Hence, an organization can potentially have collision coverage for new vehicles (CN), collision coverage for old vehicles (CO), comprehensive coverage for new vehicles (PN), and comprehensive coverage for old vehicles (PO). These six coverage groups are further described in Table \@ref(tab:DescribeCover).


```{r echo = FALSE}
types <- c("Building and Contents", "Contractors Equipment", "Collision" ,"Comprehensive", "N - New", " O - Old") 
		
descBC <- "This coverage provides insurance for buildings and the properties within. In case the policyholder has purchased a rider,  claims in this group may reflect additional amounts covered under endorsements."  
descIM <- "IM, an abbreviation for inland marine, is used as a coverage code for equipment coverage, which originally belong to contractors." 
descCol <- "This provides coverage for impact of a vehicle with an object, impact of vehicle with an attached vehicle, or overturn of a vehicle." 
descComp <- "Direct and accidental loss or damage to motor vehicle, including breakage of  glass, loss caused by missiles, falling objects, fire, theft, explosion,  earthquake, windstorm, hail,  water, flood, malicious mischief or vandalism,  riot or civil common, or colliding with a bird or animal." 
descNew <- "This code is used as an indication that the coverage is for vehicles of current model year, or 1 to 2 years prior to the current model year."
descOld <- "This code is used as an indication that the coverage is for vehicles three or more years prior to the current model year." 

Descrip <- c(descBC, descIM, descCol, descComp, descNew, descOld)

text_tbl <- data.frame(types, Descrip)
colnames(text_tbl) <- c("Coverage", "Description")
```


```{r DescribeCover, echo = FALSE}
if (HtmlEval){
knitr::kable(text_tbl, caption = "**Coverage and Description of Property Fund Risk Types**", booktabs = T) %>%
  kableExtra::kable_classic(full_width = FALSE) %>% 
  column_spec(1,  width = "2.5cm") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"))
}
if (PdfEval){
  TextTitle <- "Coverage and Description of Property Fund Risk Types"
  TextTitle1 <- paste0('\\textbf{',TextTitle,'}', collapse='')
  knitr::kable(text_tbl, caption = TextTitle1, booktabs = T) %>%
  kableExtra::kable_classic(full_width = FALSE) %>% 
  kableExtra::column_spec(1,  width = "2.5cm") %>%
  kableExtra::column_spec(2, width = "9.0cm") %>%   
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"),font = 9)
}

```

In modeling work, one may label the six risk types as $(X_1, \ldots, X_6)$ or use the more informative labels $(X_{BC}, X_{IM}, X_{CN}, X_{CO}, X_{PN}, X_{PO})$. Further, as will be seen in Section `r ChapCrossRef(Ch6Eval,"\\@ref(Sec:PropertyFund)", "6.3")`, I will consider 1,098 members of the fund. If one uses the label $i$ to identify each member, then we might be interested in aggregate claims for that member. Without risk transfers, this is

$$
S_i = X_{i,BC}+ X_{i,IM}+ X_{i,CN}+ X_{i,CO}+ X_{i,PN}+ X_{i,PO} .
$$

Moreover, we will be interested in risk transfer agreements at the fund level. In absence of any risk transfer agreement, the fund is responsible for the aggregate losses, $S = \sum_{i=1}^{1098} S_i$.

:::: {.blackboxvideo }
```{r, include=HtmlEval, echo=FALSE}
cat('**Video: Section Summary**')
```
:::: 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_au08j6bo&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&wid=1_2bg2qz1n" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *"  frameborder="0" title="FreesRiskRetentionChap1_2"></iframe>

</center>

## Investment Portfolio Strategies {#Sec:InvestStrategy}

This book approaches diversifying risky portfolios similar to the strategy pioneered by @markowitz1952utility in his development of asset portfolio theory. In this approach, the investor considers $p$ asset risks and wishes to determine $c_j$, the proportion of wealth allocated to the *j*th risk. The goal is to minimize the uncertainty of the portfolio subject to a budget constraint based on the portfolio earning a required expected return level. [Example 1.3.1] provides a concrete example of risks typically encountered in the investment allocation problem.


<a id=Ex1.3.1></a> 

[Example 1.3.1]: ./C1Introduction.html#Ex1.3.1

\index{case studies!insurance stock returns}\index{asset portfolio theory}
**[Example 1.3.1]{#Ex1.3.1}. Portfolio of Insurance Stock Returns.** I consider a portfolio of $p=8$ asset risks from the insurance sector. For illustrative purposes, the largest companies (by [market capitalization](https://companiesmarketcap.com/insurance/largest-insurance-companies-by-market-cap/)) in each of eight countries were chosen. With ticker symbols in parens (), they are:

*  United Health (UNH)  - *USA*
*  AIA Group Limited (1299.HK) - *Hong Kong*
*  Ping An Insurance (Group) Company of China, Ltd. (2318.HK) - *China* 
*  Chubb (CB) - *Switzerland*
*  Allianz (ALV.DE) - *Germany*
*  Aon (AON) - *UK*
*  AXA (CS.PA) - *France*
*  Tokio Marine (8766.T) - *Japan*.

Daily stock prices were extracted from [Yahoo Finance](https://finance.yahoo.com/) for the period 5 January 2015 to 14 September 2023 and are displayed in Figure \@ref(fig:NormalPrices). Over the entire period, United Health had the largest price increase. 

`r HideRCode('InsuranceStock.1',"R Code to Extract Yahoo Returns")`

`r PdfNote.fct('See the *Online Supplement* for illustrative statistical code.')`

```{r Example131A, eval = FALSE, echo = HtmlEval}

# download data from Yahoo Finance
# Pick some insurance stocks...
# https://companiesmarketcap.com/insurance/largest-insurance-companies-by-market-cap/
# https://finance.yahoo.com/
library(quantmod)  # to download stock data
stock_namelist <- c("UNH", "1299.HK","2318.HK",  "CB", 
                    "ALV.DE", "AON",  "CS.PA",  "8766.T")
datesToFrom <- c("2015-01-01", "2023-12-31")
prices <- xts()
for (i in 1:length(stock_namelist)) {
  tmp <- Ad(getSymbols(stock_namelist[i], from = datesToFrom[1], 
                       to = datesToFrom[2], auto.assign = FALSE))
  tmp <- na.approx(tmp, na.rm = FALSE)  # interpolate NAs
  prices <- cbind(prices, tmp)
  }
for (i in 1:ncol(prices)) {
  prices[,i] <- na.approx(prices[,i], na.rm = FALSE)  # interpolate NAs
  }

Short_stock_namelist <- c("United Health", "AIA","Ping An",  "Chubb", 
                          "Allianz", "Aon",  "AXA",  "Tokio Marine")
colnames(prices) <- Short_stock_namelist
indexClass(prices) <- "Date"
prices <- prices[-nrow(prices),]
prices <- prices[-1,]
#str(prices)
#summary(prices)
#round(head(prices),digits = 2)
#tail(prices)
# I 'save' and 'load' intermediate steps while developing. 
#    Simply for re-running code, this is not necessary.

save(prices, file= "../ChapTablesData/Chap1/InsurSectorPrices2023.Rdata")

```

</div>

`r HideRCode('InsuranceStock.2',"R Code to Split Data")`


```{r Example131B, eval = FALSE, echo = HtmlEval}

#  Create Returns
load(file= "../ChapTablesData/Chap1/InsurSectorPrices2023.Rdata")

Return <- (prices/stats::lag(prices) - 1)[-1]
p.num  <- ncol(Return)  # number of stocks

#We now divide the data into a training set and test set:
# Training 2015-01-05 to 2019-12-31
# TestingOLD 2020-06-01 to 2022-05-31
# Testing 2020-06-01 to 2023-08-31

Return_trn <- Return[1:1299, ]
Return_tst <- Return[1427:2188, ]

T_trn <- nrow(Return_trn)
mu    <- colMeans(Return_trn, na.rm = TRUE)
Sigma <- cov(Return_trn, use = "pairwise.complete.obs")

save(Return, p.num, Return_trn, Return_tst, 
     T_trn, mu, Sigma, 
     file= "../ChapTablesData/Chap1/InsurSectorReturns2023.Rdata")

```
</div>

(ref:NormalPrices) **Normalized Stock Prices of Eight Insurers** 

```{r NormalPrices, echo = FALSE, fig.cap = '(ref:NormalPrices)', fig.asp=.80}
#  Plot Figure
load(file= "ChapTablesData/Chap1/InsurSectorPrices2023.Rdata")
load(file= "ChapTablesData/Chap1/InsurSectorReturns2023.Rdata")
mydata <- prices/rep(prices[1, ], each = nrow(prices))
{ if (HtmlEval) {  plot(mydata,   main = "", grid.col = "lightgray", lwd = 1)} else {
 plot(mydata,   main = "", grid.col = "lightgray", lwd = 1, col = "black") }
addLegend("topleft", pch=0, cex=0.8,bty = "o")
addEventLines(xts("                      ", 
                  index(Return["2015-01-06"])), srt=00, 
                        pos=1, lwd = 4, col = FigDBlue)
addEventLines(xts("training              ", 
                  index(Return["2019-12-31"])), srt=00, 
                        pos=1, lwd = 4, col = FigDBlue)
addEventLines(xts("               testing", 
                  index(Return["2020-06-01"])),  srt=0, 
                        pos=1, lwd = 4, col = FigDGreen)
addEventLines(xts("", 
                  index(Return["2023-05-31"])),  srt=0, 
                        pos=1, lwd = 4, col = FigDGreen)
}

```


As is common in finance, insurance, and other areas that employ data science, I split the data into two components. The first is a five-year *training* period, 5 January 2015 to 31 December 2019, that will be used to develop alternative portfolios. The second is a three-year *test* period, 1 June 2020 to 31 May 2023, that will be used to assess the performance of the portfolios. From Figure \@ref(fig:NormalPrices), one can see that during the period omitted (in between the training and test periods), most stock prices dropped dramatically due to the global effect of the Covid pandemic. There are various ways of modeling such outlying features - for this analysis, I choose to omit this aberrant behavior. Table \@ref(tab:ReturnSummary) summarizes several performance measures over training and testing periods.


```{r ReturnSummary, echo = FALSE}
#  Create Table
temp1 <- t(table.AnnualizedReturns(Return_trn))
temp2 <- t(table.AnnualizedReturns(Return_tst))
RetSumm <- cbind(as.matrix(temp1), as.matrix(temp2))
colnames(RetSumm) <- c("Train Ann Return",    "Train Std Dev", 
                       "Train Sharpe (Rf=0)", "Test Ann Return", 
                       "Test Std Dev", "Test Sharpe (Rf=0)" )
TableGen1(TableData=RetSumm, 
         TextTitle='Insurance Sector Performance Measures', 
         Align='r', Digits=3, ColumnSpec=1:6, ColWidth0= "3.5cm",
         BorderRight= 1, ColWidth= "1.2cm")

```

For notation, let $R_1, \ldots, R_8$ be the returns from the eight risks. With investment allocations $c_j$ that sum to one, one can form the portfolio return

$$
c_1 R_1 + \cdots + c_8 R_8 .
$$

The goal is to determine the investment allocations $c_j$ in a way that minimizes the uncertainty of this portfolio return subject to a budget constraint.

***

####  Liability Risk Portfolio Strategy {-}

For diversifying a portfolio of insurable risks, one can also start with a set of $p$ risks. But, instead of these risks being assets that might be purchased, they are obligations of a person or firm. The risk owner may transfer a portion of each insurable risk to another organization (e.g., an insurance pool or an insurer) using one of several potential mechanisms available (e.g., an upper limit, deductible, coinsurance, and so on), each having parameters $\theta_j$ that calibrate the extent of the transfer. The uncertainty of the retained risk portfolio is to be minimized. The minimization is subject to a budget constraint based on restricting the amount that a risk owner is able to pay for the risk transfer. Because the goal is to minimize the uncertainty through risk transfer and retention, think of this too as optimal diversification of the portfolio.


#### Comparing Asset Investment and Liability Risk Portfolio Strategies {-}

Despite investments and risk management arising from very different application areas, their overall premise is similar, minimizing the amount of uncertainty from a portfolio of risks subject to costs associated with acquiring the risks. 

However, in their applications, they differ in one fundamental aspect; asset allocations have traditionally focused on the proportion of wealth to be invested in each risk as the decision variable. This is a *linear* allocation. In contrast, contracts for managing insurable risks routinely utilized non-linear mechanisms such deductibles and upper limits. As will be seen, the linearity in asset allocations means that investment strategies can be analyzed using linear and convex optimization methods; these methods are readily scalable to large numbers of risks (e.g., in the thousands). In contrast, the non-linearities in managing insurable risks means that, in many important problems, convexity is not available. This means that numerical optimization methods provide local, not global, solutions and can typically be implemented based on far fewer decision variables (e.g., twenty will be large, not in the thousands).

There are other less prominent, but nonetheless important, distinctions between applications in investment and risk management. 

1.  Asset allocations have traditionally used the variance and standard deviation as measures of uncertainty. Even for assets, they are not good practical measures of risk since they penalize both the unwanted high losses and the desired high gains in the same way. Further, these measures emphasize deviations from central tendencies. In contrast, alternative measures for risk (such as the value at risk) focus on extreme outcomes that can be far from the center of the distribution.

2. Another distinction is the importance of *boundary cases*. In investments, an allocation of $c_j=0$ means no investment in the *j*th asset and similarly, in many cases a retention parameter $\theta_j=0$ means no (or full) retention of the *j*th risk. In investments, many analysts also permit short sales (a negative investment essentially achieved by borrowing money) so that $c_j$ is allowed to become negative and meaning that $c_j=0$ is not even a boundary case. In contrast, in insurance the concept of "negative insurance" is typically viewed as contrary to public policy (it becomes a gamble) and so is not permissible. Thus, there is a large insurance literature on boundary cases that attempts to identify when a risk (typically, a person) is fully or only partially insured.

3. Yet another distinction is the availability of information about the distribution of a risk. In investments, the typical model assumes that risk outcomes are observable on a public market and that all parties have knowledge of its distribution. In insurance applications, information can be more private. As a consequence, pricing the transfer of risk is more commonly realized as a transaction between two parties, not a price that is observed on a public market. Therefore, care is needed when discussing each party's perspective on a transfer and in particular when discussing budget constraints involving the "cost of acquiring" an insurable risk.

:::: {.blackboxvideo }
```{r, include=HtmlEval, echo=FALSE}
cat('**Video: Section Summary**')
```
:::: 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_8seygx2o&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&wid=1_52mhqhlk" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *"  frameborder="0" title="FreesRiskRetentionChap1_3"></iframe>

</center>


## Risk Transfers and Effects of Dependence {#Sec:MinScenario}

Management techniques for handling the many risks that organizations face is further discussed in Sections `r ChapCrossRef(Ch6Eval,"\\@ref(Sec:RiskMgtFundamentals)", "6.1")` and `r ChapCrossRef(Ch6Eval,"\\@ref(Sec:RiskFinanceMethods)", "6.2")`. As already suggested by the economic activity summarized in Table \@ref(tab:Table12), risk transfer techniques such as insurance play a prominent role. Further, it is not surprising that these multiple risks naturally depend upon one another. This section gives our first introduction on how one can quantify the effects of dependence when transferring risks.

\index{insurance economics!background risk}
**Retained Risk.** To emphasize the impact of the dependence, this section uses a *minimal scenario* starting with only two risks. Specifically, suppose that a company already has a suite of risks, denoted by the random variable $X_1$, and is considering transferring either all or a portion of a second risk, $X_2$. The suite of risks in $X_1$ are sometimes known to as *background* risks in that they are not part of the risks being transferred but, as we will see, can influence risk management decisions. Companies want to transfer large risks that are potentially harmful and so agreements specifying that the firm retains $\min(X_2,u)$ and transfers an amount $X_2 - \min(X_2,u)$ are common. Here, the fixed constant $u$ is known as an *upper limit* of risk that the company will retain. The total risk retained by the company is

$$
S(u) = X_1 + \min(X_2, u) .
$$
There can be other expenses in the total retained risks including claim adjustment costs for retained risk, as well as external (brokers, consultants and other vendors) and internal (staff and related) risk management costs. However, in keeping with our minimal scenario, for now I restrict attention to $S(u)$ as a measure of total retained risk.

To provide more context, suppose that $X_2$ represents a company's workers' compensation claims. The upper limit $u$ might be set as part of a so-called *large deductible program* with an insurer. For this type of an agreement, the insurer is the first payer on all losses and it will bill the company (the insured) for the amount that falls less than $u$. If the company does not or no longer can pay its claims, then the insurer is responsible for paying those losses. To make sure that the company will honor its obligation to cover claims less than $u$, insurers often require an amount to be set aside as collateral, typically as a line of credit, cash, or bonds. This collateral depends on the distribution of $X_2$ but may also be determined accounting for the company's ability to meet all of its obligations through the distribution of $S(u)$. @mildenhall2022 refer to upper limit contracts as the "basic building block of insurance" and so these contracts provide an appropriate starting point for our investigations.

**Risk Transfer Cost.** In general, the risk amount $X_2 - \min(X_2,u)$ is transferred (to an insurer or a pool) and naturally there is a cost for this transfer. In this minimal scenario, we use the *risk transfer cost*

\begin{equation}
RTC(u) = \mathrm{E} \left\{ X_2 - \min(X_2,u)\right\} ,
(\#eq:RTC)
\end{equation}

\index{risk transfer cost!fair cost}\index{risk transfer cost}
that is, the expected, or "fair," cost. Other cost structures will be considered in subsequent sections and we will see that typically the cost of insurance depends on the market supply of insurance, among other factors. The key feature of this structure is that the cost decreases as the amount retained increases. For example, in equation \@ref(eq:RTC) $RTC(u)$ decreases with the upper limit $u$. 

In keeping with the principle of constructing a minimal scenario devoid of unnecessary complications, assume that $X_1$ and $X_2$ are both distributed Uniform(0,1). With this, it is easy to check that $RTC(u) = \frac{1}{2}(1+u^2) - u$. However, these two risks may depend on one another and so we consider their joint distribution function. In particular, the joint distribution function of two uniform (0,1) variables is known as a *copula.* We utilize a Frank copula as it is commonly used in insurance studies. To keep the book self-contained, an introduction to copulas is presented in Section `r ChapCrossRef(Ch4Eval,"\\@ref(Sec:CopulaIntro)", "4.2")`.\index{copula!Frank}\index{copula}


### Minimal Scenario 1.  Effects of Dependence {#Sec:MinScenarioA}

There are many ways to measure the uncertainty of $S(u)$, the total risk retained by the firm after the risk transfer; an overview of these measures is in Section `r ChapCrossRef(Ch2Eval,"\\@ref(Sec:RiskMeasures)", "2.2.3")`. All measures are based on the distribution of $S(u)$ and so we begin with its distribution function. 

**Using a Distribution Function to Measure Uncertainty.** In particular, if one evaluates the distribution function at a particular level, say $Q$, then in risk management applications one can interpret $Q$ as the "capital" required by the firm for the retained risk. For example, $Q$ might represent the collateral in a large deductible program. That is, if a company holds assets $Q$ to cover retained risks, then $\Pr(S(u)\le Q)$ gives the probability that retained risks will be less than these assets. A company wishes to set aside the appropriate amount of assets to cover risks. Too low a value of $Q$ means that assets are insufficient to cover retained risks meaning that the company is under insured. Too high a value of $Q$ means that capital is unnecessarily deployed on risk transfer, at the expense of other business enabling activities. 

**Using a Quantile to Measure Uncertainty.**  To complement the distribution function, we also look to the value at risk, denoted as $VaR$. The value at risk is simply a quantile or an inverse distribution function. For example, we use $VaR_{0.95}$ to represent the 0.95 level of the $VaR$. This is the amount so that there is a 95 percent probability that retained risks are less than or equal to $VaR$. Risk managers regularly employ value at risk concepts and they will take on a prominent role is our development. Section `r ChapCrossRef(Ch2Eval,"\\@ref(Sec:RiskMeasures)", "2.2.3")` provides additional background on $VaR$.
\index{risk measure!defined!value at risk, $VaR$}

By assumption, the risk transfer cost defined in equation \@ref(eq:RTC) decreases as the amount of retained risk increases. It is not surprising that the probability of having sufficient capital decreases as the amount of retained risk increases. This example shows that this probability is a function of the dependence between the two risks. To support these observations, Figure \@ref(fig:Example141A) summarizes several important points.

\pagebreak

`r HideRCode('Section141.Hide',"R Code for Section 1.4.1")`


```{r Example141, eval = FALSE, echo = HtmlEval}
set.seed(2017)
nsim      <- 100000
Q.def     <- 1.3
uparam    <- seq(0, 1, length.out = 11)
u.compare <- 7
u.def     <- uparam[u.compare]
rhoparam  <- (-9:9)/10
rho.ind   <- 10; rho.lower <- 10-3; rho.upper <- 10+3
nrhoparms <- length(rhoparam)
QuanS     <- matrix(0,length(uparam),length(rhoparam))
dfS       <- matrix(0,length(uparam),length(rhoparam))
# Generate Dist Function at Q.def and Quantiles 
# for several dependence parameters
for (j in 1:length(rhoparam)) {
  FrankParam <- copula::iRho(frankCopula(param=1, dim = 2), rho=rhoparam[j])
  nc <- copula::frankCopula(param = FrankParam, dim = 2)
  X  <- copula::rCopula(nsim, nc)
  #  Loop over several upper limits
  for (i in 1:length(uparam)) {
    u1 <- uparam[i]
  Sretained <- pmin(X[,1]) + pmin(X[,2],u1) 
  if ((j == rho.ind)  *(i==u.compare))    {Sret.ind   <- Sretained }
  if ((j == rho.lower)*(i==u.compare))    {Sret.lower <- Sretained }
  if ((j == rho.upper)*(i==u.compare))    {Sret.upper <- Sretained }
  df         <- ecdf(Sretained)
  dfS[i,j]   <- df(Q.def)
  QuanS[i,j] <- quantile(Sretained, probs = c(0.95))
  }
}
Qaxis <- seq(1.3, 1.65, length.out = 11)
df <- ecdf(Sret.ind);   dfQ.ind   <- df(Qaxis)
df <- ecdf(Sret.lower); dfQ.lower <- df(Qaxis)
df <- ecdf(Sret.upper); dfQ.upper <- df(Qaxis)

Quanaxis <- seq(0.84, 1, 0.01)
QuanS.ind   <- quantile(Sret.ind,   probs = Quanaxis)
QuanS.lower <- quantile(Sret.lower, probs = Quanaxis)
QuanS.upper <- quantile(Sret.upper, probs = Quanaxis)
save(uparam, dfS, QuanS, Sret.ind, dfQ.ind, Sret.lower, dfQ.lower,
     Sret.upper,dfQ.upper, QuanS.ind, QuanS.lower, QuanS.upper,
     rho.ind, rho.lower, rho.upper, rhoparam,
     file = "../ChapTablesData/Chap1/MinScenario1.RData")

```


</div> 

*  The upper left-hand panel shows the distribution function $\Pr(S(u)\le Q)$ as a function of the capital amount $Q$. For this demonstration, I use $u=0.6$ to limit the retention for the second risk. As anticipated, the distribution function increases as the capital $Q$ increases. For each  $Q$, the probability is smaller for positive dependence, the dotted `r printHtml("red", "")` line that corresponds to a Spearman correlation of 0.3, and larger for negative dependence, the dashed `r printHtml("blue", "")` line that corresponds to a Spearman correlation of $-0.3$.
*  The upper right-hand panel gives the same information in terms of the value at risk $VaR_{0.95}$. As the upper limit for the first retained risk is 1 and is 0.6 for the second risk, it is not possible to exceed 1.6. For any probability level, the value at risk for positively associated risks is greater than the independence case, and is lower for negatively associated risks. This is consistent with the information presented in the upper left-hand panel and conforms to our intuition.
*  The lower left-hand panel presents the distribution function, fixing the capital level at $Q=1.3$, but allowing the retention limit $u$ to vary. If $u \le 0.3$, then the combined risk $S$ must be below $Q=1.3$ and so the probability equals one. If $u > 0.3$, then the probability decreases as $u$ increases because the amount of retained risks increases. 
*  The lower right-hand panel presents the value at risk $VaR_{0.95}$ compared to the risk transfer cost, $RTC(u)$, over different choices of $u$. This is the trade-off the portfolio manager faces, smaller risk transfer costs means a greater need for retained capital. Note that the risk transfer cost does not "depend on the dependence" in contrast to the value at risk.

 

(ref:Example141A) **Portfolio Uncertainty in a Minimal Scenario.** \small The solid black line corresponds to the case of independence. The dotted `r printHtml("red", "")` line is for a positive Spearman correlation 0.3, the dashed `r printHtml("blue", "")` line is for a negative correlation $-0.3$.

```{r Example141A,  echo=FALSE, fig.cap='(ref:Example141A)'}
#  Plot Figure
load(file = "ChapTablesData/Chap1/MinScenario1.RData")
Qaxis <- seq(1.3,1.65, length.out = 11)
Quanaxis <- seq(0.84, 1, 0.01)
par(mfrow = c(2,2))
plot(Qaxis,dfQ.ind, type = "l", ylab="Distribution Function", 
     xlab = "Capital", main="u=0.6")
lines(Qaxis,dfQ.lower,  col=FigBlue, lty=2)
lines(Qaxis,dfQ.upper,  col=FigRed, lty=3)

plot(Quanaxis,QuanS.ind, type = "l", ylab="VaR", 
     xlab = "Probability", main="u=0.6")
lines(Quanaxis,QuanS.lower,  col=FigBlue, lty=2)
lines(Quanaxis,QuanS.upper,  col=FigRed, lty=3)

plot(uparam,dfS[,rho.ind], type = "l", ylab="Dist Fct at Q=1.3", 
     xlab = "Limit Parameter u")
lines(uparam,dfS[,rho.lower],  col=FigBlue, lty=2)
lines(uparam,dfS[,rho.upper],  col=FigRed, lty=3)

ICost <- (1+uparam**2)/2 - uparam
plot(ICost,QuanS[,rho.ind], type = "l", ylab="VaR", 
     xlab = "Risk Transfer Cost")
lines(ICost,QuanS[,rho.lower],  col=FigBlue, lty=2)
lines(ICost,QuanS[,rho.upper],  col=FigRed, lty=3)

```


Figure \@ref(fig:Example141Ba) emphasizes the effect of dependence.

*  The left-hand panel presents the distribution function at $Q=1.3$ and $u=0.6$ but allows the dependence, as quantified through Spearman's correlation, to vary. For a given retention level, the probability of retained risks being less than or equal to a given level of capital decreases as the level of association increases.
*  The right-hand panel presents the value at risk $VaR_{0.95}$ at $u=0.6$ but allows the dependence, as quantified through Spearman's correlation, to vary. The required capital increases as the level of association increases.


`r HideRCode('Example141B.Hide',"R Code for Figures")`

```{r Example141B, eval = FALSE, echo = HtmlEval}
#  Plot Figure
par(mfrow = c(1,2))
plot(rhoparam,dfS[6,], ylab="Dist Fct at Q=1.3", xlim = c(-1,1) , cex=0.8, 
     xlab="Spearman's Rho", type = "b", main="u=0.6")
plot(rhoparam,QuanS[6,], ylab="VaR", xlim = c(-1,1) , cex=0.8, 
     xlab="Spearman's Rho", type = "b", main="u=0.6")

```

</div>  

(ref:Example141Ba) **Effects of Dependence on Measures of Portfolio Uncertainty**


```{r Example141Ba, ref.label = 'Example141B', echo=FALSE, out.width='80%', fig.cap='(ref:Example141Ba)'}

```


`r PdfNote.fct('See the *Online Supplement* for the Section 1.4.1 illustrative statistical code.')`

### Minimal Scenario 2. Form of Risk Transfer {#Sec:MinScenarioB}

There are many alternative methods, or forms, of transferring risks; Section 
`r ChapCrossRef(Ch6Eval,"\\@ref(Sec:RiskMgtFundamentals)", "6.1")` provides a broad discussion on whether or not to transfer risk and ways of doing so. At this stage, we wish to emphasize by means of an example that the financial consequences of the choice of the risk transfer form and show how it "depends on the dependence" among risks. 

**Risk Transfer Forms.** Again, consider the minimal scenario in which a manager with background risks in $X_1$ would like to transfer a portion of a second risk $X_2$. The prior Section \@ref(Sec:MinScenarioA) considers the case where the manager retains $\min(X_2,u)$. As one alternative, the manager may wish to retain a simple proportion of the second risk, say $c X_2$, where $c$ is a fixed constant. Later, we will call this the *coinsurance* case. As another alternative, the manager may wish to retain $X_2 - \min(X_2,d)$ where we think of $d$ as a *deductible*. 

As before, we assume that both $X_1$ and $X_2$ have uniform distributions and that risk transfer costs are fair and determined via taking expectations. We now denote the risk transfer cost of the upper limit policy as $RTC_u(u) = \frac{1}{2}(1+u^2) - u$. In the same way, it is easy to check that risk transfer costs for the alternatives are

$$
RTC_c(c) = \frac{1}{2}(1-c) \ \ \ \text{and} \ \ \ RTC_d(d) = d- \frac{d^2}{2}.
$$

For a meaningful comparison, we assume that these alternatives produce the same risk transfer cost, say $RTC_0$. Then, we can compute the value of the upper limit $u$ needed to attain this cost through the relation $RTC_u(u) = RTC_0$. This turns out to result in

$$
u = 1 - \sqrt{2 \times RTC_0} .
$$

In the same way, we can determine the coinsurance and deductible parameters that result in the risk transfer cost $RTC_0$. They are


$$
c = 1 - 2 \times RTC_0 \ \ \ \text{and} \ \ \ d = 1 - \sqrt{1-2 \times RTC_0}.
$$

`r HideRCode('Section142.Hide',"R Code to Generate the Data")`


```{r Example142, eval = FALSE, echo = HtmlEval}
nsim <- 100000
set.seed(2017)
Q.def = 1.1
IC0.compare <- 7
IC0 <- seq(0, 0.5, length.out = 11)
uVec <- 1-sqrt(2*IC0)
cVec <- 1- 2* IC0
dVec <- 1-sqrt(1-2*IC0)
rhoparam<- (-9:9)/10
rho.ind <- 10; rho.lower <- 10-3;rho.upper <- 10+3
nrhoparms <- length(rhoparam)
QuanS <- matrix(0,length(IC0),length(rhoparam))
dfS1 <- matrix(0,length(IC0),length(rhoparam)) -> dfS2 -> dfS3 
Sretained <- matrix(0,nsim,3)
Sret.ind.mat <- matrix(0,nsim,3) -> Sret.lower.mat -> Sret.upper.mat
for (j in 1:length(rhoparam)) {
  FrankParam <- iRho(frankCopula(param=1, dim = 2), rho=rhoparam[j])
  nc <- frankCopula(param = FrankParam, dim = 2)
  X <- rCopula(nsim, nc)
  for (i in 1:length(IC0)) {
  Sretained[,1] <- X[,1] + pmin(X[,2],uVec[i]) 
  Sretained[,2] <- X[,1] + cVec[i]*X[,2] 
  Sretained[,3] <- X[,1] + X[,2] - pmin(X[,2],dVec[i]) 
  if ((j == rho.ind)  *(i==IC0.compare))    {Sret.ind.mat   <- Sretained }
  if ((j == rho.lower)*(i==IC0.compare))    {Sret.lower.mat <- Sretained }
  if ((j == rho.upper)*(i==IC0.compare))    {Sret.upper.mat <- Sretained }
  if ((j == rho.ind))    {Sret.ind.mat   <- Sretained }
  df <- ecdf(Sretained[,1]);   dfS1[i,j] <- df(Q.def)
  df <- ecdf(Sretained[,2]);   dfS2[i,j] <- df(Q.def)
  df <- ecdf(Sretained[,3]);   dfS3[i,j] <- df(Q.def)
  }
}
save(dfS1, dfS2,dfS3, IC0, file = "../ChapTablesData/Chap1/MinScenario2.RData")

```

</div> 

Figure \@ref(fig:Example142Fig1a) shows, for each type of risk transfer, that the probability of being less than or equal to a required capital amount ($\Pr[S(u) \le Q]$, $Q=1.1$ for this demonstration) is largest for the case of negatively dependent risks and smallest for positively dependent risks, as before.

`r HideRCode('Section142Fig.Hide',"R Code To Plot this Figure")`

```{r Example142Fig1, eval = FALSE, echo = HtmlEval}
#  Plot Figure
load( file = "ChapTablesData/Chap1/MinScenario2.RData")
rho.ind <- 10; rho.lower <- 10-3;rho.upper <- 10+3
par(mfrow = c(1,3))
plot(IC0,dfS1[,rho.ind], type = "l", ylab="Distribution Function", 
                         xlab = expression(RTC[0]),main = "Upper")
lines(IC0,dfS1[,rho.lower],  col=FigBlue, lty=2)
lines(IC0,dfS1[,rho.upper],  col=FigRed, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")

plot(IC0,dfS2[,rho.ind], type = "l", ylab="Distribution Function", 
                         xlab = expression(RTC[0]),main = "Coinsure")
lines(IC0,dfS2[,rho.lower],  col=FigBlue, lty=2)
lines(IC0,dfS2[,rho.upper],  col=FigRed, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")

plot(IC0,dfS3[,rho.ind], type = "l", ylab="Distribution Function", 
                         xlab = expression(RTC[0]),main = "Deduct")
lines(IC0,dfS3[,rho.lower],  col=FigBlue, lty=2)
lines(IC0,dfS3[,rho.upper],  col=FigRed, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")
```

</div>  

(ref:Example142Fig1a) **Distribution Function versus the Risk Transfer Cost for a Risk, by Risk Transfer Type.** \small Within each risk transfer type, the solid black line corresponds to the case of independence. The dotted `r printHtml("red", "")` line is for a positive Spearman correlation 0.3, the dashed `r printHtml("blue", "")` line is for a negative correlation $-0.3$.

```{r Example142Fig1a, ref.label = 'Example142Fig1', echo = FALSE, fig.cap='(ref:Example142Fig1a)'}

```

To emphasize the importance of the risk transfer type, Figure \@ref(fig:Example142Fig2a) switches the presentation. Here, the middle and right-hand panels of Figure \@ref(fig:Example142Fig2a) represent the case of independence and positive dependence (correlation = 0.3), respectively. They show that the upper limit is the preferred form of risk transfer agreement in the sense that it has the largest probability of being less than or equal to a required capital amount. The coinsurance form is close, particularly for the case of independence. The left-hand panel representing negative dependence (correlation = $-0.3$) suggests that there is no clear winner among the three risk transfer types.


`r HideRCode('Motivation.5',"R Code for To Plot this Figure")`

```{r Example142Fig2, eval = FALSE, echo = HtmlEval}
par(mfrow = c(1,3))
plot(IC0,dfS1[,rho.lower], type = "l", ylab="Distribution Function", 
                           xlab = expression(RTC[0]), main="Neg Depend")
lines(IC0,dfS2[,rho.lower],  col=FigGreen, lty=2)
lines(IC0,dfS3[,rho.lower],  col=FigOrange, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")

plot(IC0,dfS1[,rho.ind], type = "l", ylab="Distribution Function", 
                         xlab = expression(RTC[0]), main="Independ")
lines(IC0,dfS2[,rho.ind],  col=FigGreen, lty=2)
lines(IC0,dfS3[,rho.ind],  col=FigOrange, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")

plot(IC0,dfS1[,rho.upper], type = "l", ylab="Distribution Function", 
                           xlab = expression(RTC[0]), main="Pos Depend")
lines(IC0,dfS2[,rho.upper],  col=FigGreen, lty=2)
lines(IC0,dfS3[,rho.upper],  col=FigOrange, lty=3)
abline(0.9,0,  col="grey")
abline(0.8,0,  col="grey")
abline(0.7,0,  col="grey")
abline(0.6,0,  col="grey")
abline(v = 0.2,  col="grey")
abline(v = 0.3,  col="grey")
abline(v = 0.4,  col="grey")
```

</div>  

(ref:Example142Fig2a) **Distribution Function versus the Risk Transfer Cost for a Risk, by Dependence Type.** \small Within each dependence type, the solid black line corresponds to the case of upper limit. The dotted `r printHtml("orange", "")` line is for a deductible, the dashed `r printHtml("green", "")` line is for coinsurance.

```{r Example142Fig2a, ref.label = 'Example142Fig2', echo=FALSE, fig.cap='(ref:Example142Fig2a)'}

```

`r PdfNote.fct('See the *Online Supplement* for the Section 1.4.2 illustrative statistical code.')`

:::: {.blackboxvideo }
```{r, include=HtmlEval, echo=FALSE}
cat('**Video: Section Summary**')
```
:::: 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_ys8z4qkx&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&wid=1_rdk8vw5g" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *"  frameborder="0" title="FreesRiskRetentionChap1_4"></iframe>

</center>

## Overview of the Book {#Sec:Overview}

In the stripped down examples of Section \@ref(Sec:MinScenario), we saw in action some of the key elements of liability portfolio risk strategies: different contracts for dividing risks into portions transferred and retained, summarizing the uncertainty of the portion retained and the cost of the portion transferred, and the impact of dependence among risks on the uncertainty of retained risks.

As argued in this book, the risk owner is concerned about the set of all risks in the portfolio as well as the cost of transferring portions of each risk so that the retained amount of risk is acceptable. The Section \@ref(Sec:MinScenario) examples emphasize that the retained risk portfolio uncertainty depends on the association, or dependence, among the components. In contrast, transfer costs are oftentimes exogenous, given by external market forces (supply and demand of availability), that typically do not depend on other risks in the portfolio. So, the risk portfolio manager has room to maneuver and can make selections in the risk owner’s best interests. This book develops techniques to take advantage of these opportunities.
\index{risk transfer cost!market loading}


**Part I. Foundations.** The first part, consisting of four chapters, sets the stage.


Chapter `r ChapCrossRef(Ch1Eval,"\\@ref(C1Introduction)", "1")` introduces the problem of multiple risks faced by organizations and the importance of risk transfers through the insurance marketplace. It describes case studies that further motivate the problem and introduces minimal scenarios to underscore the role of uncertainty and costs for mitigating this uncertainty, as well as the importance of dependence among risks.

Chapter `r ChapCrossRef(Ch2Eval,"\\@ref(C2RetainedRisk)", "2")` on *Risk Retention Functions*  describes fundamental quantitative tools for managing risks, separating the overall set of risks into those retained by the firm and those that can be offloaded, or transferred, to another organization. For a risk retention policy, measures are introduced to quantify the uncertainty of the risk retained by the firm and the costs of offloading risks.

Chapter `r ChapCrossRef(Ch3Eval,"\\@ref(C3Balance)", "3")` on *Balancing Retained Risk and Risk Transfer Cost*  provides a deeper discussion of quantifying the balance between the risk retained and the costs of offloading risks. Three approaches for quantifying this balance are introduced: a ratio that provides an intuitive measure that summarizes this balance, a formal total cost approach that can be optimized, and a more flexible constrained optimization approach. 

Chapter `r ChapCrossRef(Ch4Eval,"\\@ref(C4PortMgt)", "4")` on *Transferring Multiple Risks including Reinsurance*  extends the Chapter `r ChapCrossRef(Ch3Eval,"\\@ref(C3Balance)", "3")` approaches to include dependence and the reinsurance market yet still restricting consideration to the classic case of variance as a measure of risk uncertainty. Even with this classic measure, the nonlinearities introduced by retention policies motivate the copula as a natural vehicle for modeling dependence. Reinsurance applications suggest the introduction of a host of complex retention policies that expand the scope of applications. Reinsurance also provides a natural platform for introducing general theoretical structures for exchanging risks, the subject of Section `r ChapCrossRef(Ch4Eval,"\\@ref(Sec:RiskExchange)", "4.5")`. 



**Part II. Core Material.** The second part, Chapters 5-8, provides the core material for developing  optimal insurable risk portfolio strategies.

Chapter `r ChapCrossRef(Ch5Eval,"\\@ref(C5ExcessLoss)", "5")` is on *Excess of Loss for Two Risks*.  The first four chapters emphasize the classical case of (1) variance as a risk measure, (2) independent risks, and (3) proportional sharing of risks. In contrast, this chapter considers excess of loss, a non-proportional risk sharing mechanism, for dependent risks. It develops the distribution, quantiles, and associated derivatives for the retained risk, allowing us to quantify general (quantile) risk measures. Due to computational challenges, this chapter restricts considerations to two risks. 

Chapter `r ChapCrossRef(Ch6Eval,"\\@ref(C6ManagePort)", "6")` is on *Managing Portfolios of Insurable Risks*  emphasizes the *management* of insurable risks  and describes methods used in practice. This chapter focuses on risks faced by general commercial firms (not just insurers) but also discusses peer-to-peer exchanges that are more geared for individuals.

Chapter `r ChapCrossRef(Ch7Eval,"\\@ref(C7SimMult)", "7")` is on *Simulating Multivariate Risks*  describes how simulation can be used to optimize insurable risk portfolios. The chapter describes how to (i) simulate a portfolio of dependent risks, (ii) split the portfolio into a portion retained by the risk owner and another portion to be transferred to one or more other parties, and (iii) optimize the uncertainty of retained risks subject to budget constraints. The detailed illustrations focus on a multivariate version of an excess of loss transfer arrangement with considerations of alternative ways of measuring the uncertainty of retained risks. The strategy underpinning these illustrations can be applied to general risk retention arrangements that are also outlined in this chapter.

Chapter `r ChapCrossRef(Ch8Eval,"\\@ref(C8CaseStudies)", "8")` is on *Case Studies*  and features two illustrative examples: the Wisconsin Property Fund case, based on an insurance risk pool with many features found in a typical multi-line general insurance company, and the Australian National University (ANU) case, which considers a portfolio of risks commonly encountered by risk managers at medium and large corporations. The ANU case emphasizes stress testing due to the relative paucity of data available for some risk types.


**Part III. Properties and Characteristics.** The third part, Chapters 9 - 12, develops several properties and characteristics of optimal insurable risk portfolios that apply broadly. These properties and characteristics provide insights for developing interpretation and more robust risk retentions strategies.

Chapter `r ChapCrossRef(Ch9Eval,"\\@ref(C9Sensitive)", "9")` is on *Stress Testing, Sensitivity, and Robustness.*   The preceding chapters showed how to use constrained optimization methods to suggest desirable insurable risk portfolios. However, like any mathematical representation, constrained optimization results are based on precise model assumptions. So, when interpreting findings, it is natural to ask questions about the reliability of the results, something that risk managers are keen to understand. 
Stress testing, examining results under different scenarios, is an approach already used in prior chapters and is emphasized as a basic approach to examine results reliability. This chapter also introduces a differential approach using a tool from economics known as the Envelope theorem to quantify sensitivities. Here, *sensitivities* refer to changes in the optimization results when one changes any one of the input assumptions by a small amount. One can also entertain alternative optimization procedures that explicitly recognize parameter uncertainty. This chapter describes *robust optimization* in the context of investment portfolios to give readers a feel for this approach.

Chapter `r ChapCrossRef(Ch10Eval,"\\@ref(C10DataSens)", "10")` continues the development of sensitivities and provides linkages to *data uncertainty.* Specifically, this chapter describes a novel extension of the Envelope theorem that provides explicit gradients for decision variables based on changes in an input assumption, refered to here as a *perturbation sensitivity.* After showing how this general result can be used in a risk retention context, applications to collection of input parameters are considered. The most natural such collection is a set of risk parameters and this approach allows the introduction of *stochastic sensitivities* which can be used to gauge data uncertainty.


Chapter `r ChapCrossRef(Ch11Eval,"\\@ref(C11RTCond)", "11")` is on *Risk Retention Conditions*.  When using the method of constrained optimization to suggest a desirable insurable risk portfolio, it can be useful to understand what conditions might be suitable or desirable to transfer a risk. This chapter introduces the Karush-Kuhn-Tucker, or *KKT*, conditions that must hold for an optimal risk transfer solution. These conditions provide a convenient framework to summarize work done earlier in Chapter `r ChapCrossRef(Ch3Eval,"\\@ref(C3Balance)", "3")` for a single risk. The conditions can be used to verify classical conditions on balance among risks for multivariate excess of loss and extend them to the case of dependence, as well as achieving a binding budget and establishing that parameters are on the boundary. These conditions also help us learn about the equivalence of different optimization techniques when using simulation.

Chapter `r ChapCrossRef(Ch12Eval,"\\@ref(C12DepSens)", "12")` is on *The Role of Dependence in Managing Insurable Risks*. Managers form portfolios to rely on benefits of diversification and these benefits can be critically impacted by dependence. This chapter provides a structure for thinking about the ways in which dependence can make important differences. This structure is based on the number of risks in the portfolio and the purposes of modeling such as determining risk transfer costs, the uncertainty of a portfolio, and the risk retention parameters obtained when constructing an optimal insurable risk portfolio. In addition to sensitivity analysis, extending the work in Chapter `r ChapCrossRef(Ch9Eval,"\\@ref(C9Sensitive)", "9")`, this chapter introduces models of *contagion* where there is an association or spread of loss from one entity to another within a portfolio.

**Part IV. Supporting Materials.** The fourth part provides various materials that support and supplement the main body of the text.


**Outline of the Investment Portfolio Problem.** Many readers will likely be interested in the development of asset investment portfolio problem due to Markowitz, sometimes called the asset allocation problem in this book. This alternative name is employed to make sure that we utilize the intuition from this well-developed area of investments but do not accept conventions learned from this other industry without verifying them. To encourage readers to develop expertise is this sister industry, here is an outline of our development of the asset allocation problem.

*  The problem has already been introduced in Section \@ref(Sec:InvestStrategy).
*  The solution of the investment portfolio problem using constrained optimization is given in Section `r ChapCrossRef(Ch3Eval,"\\@ref(Sec:AssetAllocation)", "3.4")`, complete with illustrative code and data. This is the traditional approach based on minimizing the variance.
*  The minimization based on expected shortfall is given in Section `r ChapCrossRef(Ch4Eval,"\\@ref(Sec:ConvexProblems)", "4.4.1")` where it is identified as a convex problem. Again, sample code is available to encourage readers to construct their own optimal portfolios.
*  Section `r ChapCrossRef(Ch9Eval,"\\@ref(Sec:Robustness)", "9.4")` summarizes asset allocation sensitivity and introduces another approach for managing parameter uncertainty, asset allocation robustness.
*  Chapter `r ChapCrossRef(Ch10Eval,"\\@ref(C10DataSens)", "10")` discusses the data uncertainty in the asset allocation problem.  Here, “data uncertainty” refers to the observation that small changes in the risk distribution parameters can lead to large material changes in optimal risk portfolio coefficients. Data uncertainty is a major limitation of the Markowitz strategy which, fortunately, turns out to be less severe in liability risk portfolio applications.



## Supplemental Materials

### Further Resources and Readings

For this chapter and the remainder of the book, the intent is that practicing analysts, as well as other readers with experience, will be able to read the main body of the text and get the big ideas. They may wish to access code and details of mathematical justifications (or the longer derivations in the appendices) that provide a deeper experience but these can be skipped without loss of continuity.

Students, or those with less experience in the field, are encouraged to take deeper dives into the code, the theory, or preferably both. Moreover, you may wish to acquaint yourself with some related fields that provide the foundations for the development here. 

*  First and foremost is a fundamental understanding of quantifying losses. Readers wanting a quick refresher to some basic statistical and actuarial concepts may refer to the online book [Loss Data Analytics](https://openacttexts.github.io/Loss-Data-Analytics/index.html), @LDA2020. In particular, Chapter 3 describes calculation of risk transfer costs with basic retention limitations and Chapter 14 provides an introduction to copulas. Other notable introductions that provide comparable material include @Tse2009, @gray2012risk, and @klugman2012.\index{copula}
*  This book accounts for dependence among risks using a copula framework. See @hofertelements for a modern book-length introduction of copulas; @genest1986bivariate and @frees1998understanding provide classic introductory articles. @joe2014dependence provides excellent in-depth background to statistical aspects of copulas at a higher mathematical level.
*  The goal of this book is to develop a suite of quantitative techniques for risk managers and those who advise them. As such, it follows the spirit of the pioneering book aptly entitled *Quantitative Risk Management* by @embrechts2005quantitative.
*  The aim here is to develop a set of tools that can be applied to commercial insurance, as well as personal insurance, reinsurance, and other risk financing techniques. Many of the problems that we address can be motivated by the reinsurance field. An excellent quantitative introduction to this area can be found in @albrecher2017reinsurance.\index{reinsurance}
*  Technique-wise, this book employs constrained optimization extensively. In the developing this book, we used @boyd2004convex and @simon1994mathematics although there are many good resources available in this area.  


<br> \smallskip

**On Risk and Uncertainty.** This book interprets a *risk* to be a random outcome (a random variable), typically having financial implications. The *uncertainty* is the driver of the randomness and we can measure the level of uncertainty through risk measures. This is consistent with the practice of applied insurance risk modeling, see for example, @mildenhall2022 (Chapter 3) and @gutterman2017IAA. In contrast, some readers are likely to be familiar with terminology due to @Knight1921 where a distinction is made between a risk, described by an objective
 probability distribution, and uncertainty, which is not related to any precise probability distribution. Alternatively, many economists now utilize terms such as *ambiguity* to describe this type of uncertainty, cf. @Machina2013. The goal of this book is to provide quantitative modeling tools for managing collections of risks and these tools depend on the language of probability theory. The probabilities may be objective (with grounding in empirical data), including frequentist and Bayesian, or subjective (reflecting individual judgment or degree of belief); many applications utilize all three types. The adopted interpretations of risk and uncertainty are consistent with the goal of developing a suite of tools founded on our best available information about probabilities of financial outcomes.


### Exercises

\scalefont{0.8}

`r PdfNote.fct('See the *Online Supplement* for selected exercise solutions.')`


<a id=Exer1.1></a> 

[Exercise 1.1]: ./C1Introduction.html#Exer1.1

**[Exercise 1.1]{#Exer1.1}. Trade-off between Price and Uncertainty, including the Effects of Dependence.**  This exercise mimics and extends the development of the first minimal scenario in Section \@ref(Sec:MinScenarioA). The extension is to move beyond uniform (0,1) outcomes to distributions that are more representative of potential liabilities that a firm might face.

```{r  Exercise11, echo =FALSE}
#  Set-up for Ex 1.1
risk1shape <- 2
risk1scale <- 5000
risk2shape <- 3
risk2scale <- 2000

```


Specifically, in this exercise, assume:

*  That $X_1$ has a gamma distribution with mean `r ERisk1fun()` and standard deviation `r round(sdRisk1fun(),digits=0)`. With these assumptions, the 95th percentile of $X_1$ is `r round(q1(0.95), digits=0)`.
*  That $X_2$ has a Pareto distribution with mean `r ERisk2fun()`  and standard deviation  `r round(sdRisk2fun(),digits=0)`. With these assumptions, the 95th percentile of $X_2$ is `r round(q2(0.95),digits=0)`.
*  The risks $X_1, X_2$ may be dependent, assuming Frank copula to construct the dependence. 

For this exercise, you should:

**a.**  Examine the code in Section \@ref(Sec:MinScenarioA) and outline a strategy for making changes to the code. (Subsequent chapters will develop the explicit tools for doing so. At this stage, just think about the strategy.) <br>\newline
**b.**  Figure \@ref(fig:Exercise11FigAa) summarizes results from these new distributional assumptions, comparable to Figure \@ref(fig:Example141A). Interpret the upper left-hand panel, emphasizing the role of the dependence. <br>\newline
**c.**  Interpret the upper right-hand panel, emphasizing the role of the dependence. <br>\newline
**d.**  Interpret the lower left-hand panel, emphasizing the role of the dependence. <br>\newline
**e.**  Interpret the lower right-hand panel, emphasizing the role of the dependence.

(ref:Exercise11Soln) **Single Parameter Problem**. \small The solid black line corresponds to the case of independence. The dotted `r printHtml("red", "")` line is for a positive Spearman correlation 0.3, the dashed `r printHtml("blue", "")` line is for a negative correlation $-0.3$.

```{r Exercise11FigAa,  echo=FALSE,  fig.cap='(ref:Exercise11Soln)', fig.asp=.80}
#  Plot Figure
load(file = "ChapTablesData/Chap1/Exercise11.RData")

Q.def     <- 2.25*(ERisk1fun()+ERisk2fun())
Qaxis     <- Q.def*seq(from = 0.8, to = 1.4, length.out = 11)
uparam    <- seq(from = 0.0, to = q2(0.99), length.out = 11)
u.compare <- 9
u.def     <- uparam[u.compare]

par(mfrow = c(2,2))
plot(Qaxis, dfQ.ind, type = "l", ylab="Distribution Function", 
     xlab = "Capital", main=paste("u=",round(u.def,digits=0)))
lines(Qaxis,dfQ.lower,  col=FigBlue, lty=2)
lines(Qaxis,dfQ.upper,  col=FigRed, lty=3)

plot(uparam,dfS[,rho.ind], type = "l", ylab=paste("Dist Fct at Q=", Q.def), 
     xlab = "Limit Parameter u", ylim=c(.94,.96), xlim=c(0, 3000))
lines(uparam,dfS[,rho.lower],  col=FigBlue, lty=2)
lines(uparam,dfS[,rho.upper],  col=FigRed, lty=3)

plot(RTC11,QuanS.ind, type = "l", ylab="VaR", 
     xlab = "Risk Transfer Cost", ylim = c(23600,25600))
lines(RTC11,QuanS.lower,  col=FigBlue, lty=2)
lines(RTC11,QuanS.upper,  col=FigRed, lty=3)

plot(RTC11,CTE[,rho.ind], type = "l", ylab="ES", 
     xlab = "Risk Transfer Cost", ylim = c(29400,31800))
lines(RTC11,CTE[,rho.lower],  col=FigBlue, lty=2)
lines(RTC11,CTE[,rho.upper],  col=FigRed, lty=3)

```


`r HideRCode('Exercise11SolnA.6',"Solution for Exercise 1.1 - Part (a)")`

```{r  Exercise11Soln, eval = FALSE, echo = HtmlEval}
# Part a
set.seed(2017)
nsim      <- 100000
Q.def     <- 2.25*(ERisk1fun()+ERisk2fun())
uparam    <- seq(from = 0.0, to = q2(0.99), length.out = 11)
RTC11 <-  actuar::mpareto(order=1, shape = risk2shape, scale = risk2scale) - 
          actuar::levpareto(limit = uparam,shape = risk2shape, scale = risk2scale)
u.compare <- 9
u.def     <- uparam[u.compare]
rhoparam  <- (-9:9)/10
rho.ind   <- 10; rho.lower <- 10-3; rho.upper <- 10+3
QuanS     <- matrix(0,length(uparam),length(rhoparam)) -> CTE
dfS       <- matrix(0,length(uparam),length(rhoparam))
# Generate Dist Function at Q.def and Quantiles 
# for several dependence parameters
for (j in 1:length(rhoparam)) {
  FrankParam <- copula::iRho(copula::frankCopula(param=1, dim = 2), rho=rhoparam[j])
  nc <- copula::frankCopula(param = FrankParam, dim = 2)
  U  <- copula::rCopula(nsim, nc)
  X1 <- qgamma(U[,1],shape = risk1shape, scale = risk1scale)
  X2 <- actuar::qpareto(U[,2],shape = risk2shape, scale = risk2scale)
  #  Loop over several upper limits  
  for (i in 1:length(uparam)) {
  u1 <- uparam[i]
  Sretained <- pmin(X1) + pmin(X2,u1) 
  if ((j == rho.ind)  *(i==u.compare))    {Sret.ind   <- Sretained }
  if ((j == rho.lower)*(i==u.compare))    {Sret.lower <- Sretained }
  if ((j == rho.upper)*(i==u.compare))    {Sret.upper <- Sretained }
  df         <- ecdf(Sretained)
  dfS[i,j]   <- df(Q.def)
  QuanS[i,j] <- quantile(Sretained, probs = c(0.95))
  CTE[i,j]   <- sum(Sretained*(Sretained>= QuanS[i,j]))/
                     (1+sum(1*(Sretained>= QuanS[i,j])))
  }
}
Qaxis <- Q.def*seq(from = 0.8, to = 1.4, length.out = 11)
df <- ecdf(Sret.ind);   dfQ.ind   <- df(Qaxis)
df <- ecdf(Sret.lower); dfQ.lower <- df(Qaxis)
df <- ecdf(Sret.upper); dfQ.upper <- df(Qaxis)
Quanaxis    <- seq(0.92, 1, length.out = 11)
QuanS.ind   <- quantile(Sret.ind,   probs = Quanaxis)
QuanS.lower <- quantile(Sret.lower, probs = Quanaxis)
QuanS.upper <- quantile(Sret.upper, probs = Quanaxis)

save(Q.def, u.def, RTC11, dfS, dfQ.ind, dfQ.lower, dfQ.upper, 
     QuanS, QuanS.ind,  QuanS.lower,  QuanS.upper, 
#     Sret.ind, Sret.lower,  Sret.upper,
     rho.ind, rho.lower, rho.upper, rhoparam,     
     CTE,
     file = "../ChapTablesData/Chap1/Exercise11.RData")
```

</div>


`r HideSolution('Exer1.1',"Show Exercise 1.1 Solution - Parts (b)-(e)")`

```{r eval =  HtmlEval, child = './OnlineSupp/Chap1/Solutions/Exercise11Soln.Rmd'}
```


</div>

<a id=Exer1.2></a> 

[Exercise 1.2]: ./C1Introduction.html#Exer1.2

**[Exercise 1.2]{#Exer1.2}.**  Using the assumptions of [Exercise 1.1](#Exer1.1), we now mimic the minimal scenario 1 results presented in Figure \@ref(fig:Example141Ba). For a fixed upper limit, Figure \@ref(fig:Exercise12Fig) shows values of the distribution function at a point and the value at risk over different values of the association parameter.

**a.**  Interpret the left-hand panel. <br>\newline
**b.**  Interpret the right-hand panel.

(ref:Exercise12Fig) **Effects of Dependence on Measures of Portfolio Uncertainty**

```{r Exercise12Fig, echo = FALSE,fig.cap='(ref:Exercise12Fig)', fig.asp=.60}
#  Plot Figure
load(file="ChapTablesData/Chap1/Exercise11.RData")
par(mfrow = c(1,2))
plot(rhoparam,dfS[6,], ylab=paste("Dist Fct at Q=",Q.def), xlim = c(-1,1) , cex=0.8, 
     xlab="Spearman's Rho", type = "b", main=paste("u=", round(u.def,digits=0)))
plot(rhoparam,QuanS[6,], ylab="VaR", xlim = c(-1,1) , cex=0.8, 
     xlab="Spearman's Rho", type = "b", main=paste("u=",round(u.def,digits=0)))

```

`r HideSolution('Exer1.2',"Show Exercise 1.2 Solution")`


```{r eval =  HtmlEval, child = './OnlineSupp/Chap1/Solutions/Exercise12Soln.Rmd'}
```

</div>


\scalefont{1.25}


### On Your Own

This text does *not* emphasize procedures for fitting models of claims from empirical data. This is an important step and readers will find it useful to get a sense of the uncertainties that arise from this step. As we described in later chapters (see in particular Chapter `r ChapCrossRef(Ch9Eval,"\\@ref(C9Sensitive)", "9")` on sensitivity and robustness), these uncertainties play a role in the optimal insurable risk portfolios that we develop.

On your own, you may wish to review model fitting resources for the two case studies. These resources not only provide access to sample data but also illustrative `R` code for model fitting. These are:

*  @frees2022ANURisks for a detailed description of models of ANU risks summarized in Section \@ref(Sec:ANUCaseIntro)
*  @frees2016multivariate for a detailed description of models of the Wisconsin property fund summarized in Section \@ref(Sec:WiscPropFund).

As another option, many readers will wish to explore the financial asset data as introduced in Section \@ref(Sec:InvestStrategy). Use the illustrative code provided in this section to download your own sample of data, mimic the data summaries provided there, and you will be in a position to form your own stock portfolios in later chapters.

